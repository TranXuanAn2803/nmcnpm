-- Danh sách Table "Người liên quan CoV-18"
--    . Bảng cơ sở điều trị
--    . Bảng người liên quan CoV-18 (Patient)
--    . Bảng lịch sử tiếp xúc (ContactHis)
--    . Bảng lịch sử hoạt động (LogHis)

CREATE TABLE IF NOT EXISTS public."TreatmentPlace"
(
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
	name character varying(100),
	address text,
	capacity integer,
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public."Patient"
(
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
	name character varying(100),
	identity_card character varying(20),
	birthdate timestamp ,
	address text,
	status character varying (10),
	treatment_place_id integer,	
    PRIMARY KEY (id),
	CONSTRAINT fk_patient_treatmentplace FOREIGN KEY (treatment_place_id)
        REFERENCES public."TreatmentPlace" (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE,
	CONSTRAINT identity UNIQUE (identity_card)
);


CREATE TABLE IF NOT EXISTS public."ContactHistory"
(
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
	id_person integer,
	id_other_person integer,
	time_start timestamp ,
	status character varying (10),
    PRIMARY KEY (id),
	CONSTRAINT fk_contacthistory_patient FOREIGN KEY (id_person)
        REFERENCES public."Patient" (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE,
	CONSTRAINT fk_contacthistory__patient FOREIGN KEY (id_other_person)
        REFERENCES public."Patient" (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE
);


CREATE TABLE IF NOT EXISTS public."LogHistory"
(
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
	id_person integer,
	type character varying (25),
	note text,
	time_start timestamp ,
    PRIMARY KEY (id),
	CONSTRAINT fk_loghistory_patient FOREIGN KEY (id_person)
        REFERENCES public."Patient" (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE
);

-- Danh sách Table "User"
--    . Thêm bảng Tài khoản (user account)
--    . Thêm bảng quản lý lịch sử hoạt động của quản lý (managerhistory)

CREATE TABLE IF NOT EXISTS public."UserAccount"
(
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
	user_name character varying(100),
	password character varying(30),
	name character varying(100),
	identity_card character varying(20),
	role character varying(15),
	active boolean,
	is_alert boolean,
    PRIMARY KEY (id),
	CONSTRAINT username UNIQUE (user_name)
);


CREATE TABLE IF NOT EXISTS public."ManagerHistory"
(
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
	id_manager integer,
	type character varying(20),
	describe text,
    PRIMARY KEY (id),
	CONSTRAINT fk_managehistory_useraccount FOREIGN KEY (id_manager)
        REFERENCES public."UserAccount" (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE
);


-- Danh sách Table "Nhu yếu phẩm"
--    . Thêm bảng sản phẩm nhỏ (product)
--    . Thêm bảng gói nhu yếu  (neccessary package)
--    . Thêm bảng lịch sử thanh toán (payment history)

CREATE TABLE IF NOT EXISTS public."Product"
(
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
	name character varying (100),
	image text,
	note text,
	price integer,
	quantity_unit character varying (10),
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public."NeccessaryPackage"
(
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
	name character varying (100),
	list_product text,
	limit_count_package_day integer,
	limit_count_package_week integer,
	limit_count_package_month integer,
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public."PaymentHistory"
(
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
	id_package integer,
	id_payer integer,
	count integer,
	time_start timestamp,
	price integer,
	list_product text,
    PRIMARY KEY (id),
	CONSTRAINT fk_payment_neccessary FOREIGN KEY (id_package)
        REFERENCES public."NeccessaryPackage" (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE,
	CONSTRAINT fk_payment_user FOREIGN KEY (id_payer)
        REFERENCES public."UserAccount" (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE
);


-- Cần ít nhất 5 tỉnh thành , mỗi tỉnh có 5 quận huyện, mỗi quận huyện có 5 
-- phường xã. Do không cso tác vụ thêm xóa sửa địa chỉ nên chỉ cần lưu json 
-- data rồi truy xuất là được.

-- Thêm 5 địa điểm cách ly/ chữa bệnh vào data

INSERT INTO public."TreatmentPlace"(
	id, name, address, capacity)
	VALUES (1, 'Bệnh viện dã chiến số 1', '{"city":"TP.HCM","district":"Quận 9","ward":"","street":"Duy Tân","note":"Số 10 hẻm 2"}', 20);
	
	INSERT INTO public."TreatmentPlace"(
	id, name, address, capacity)
	VALUES (2, 'Bệnh viện dã chiến số 2', '{"city":"TP.HCM","district":"Quận 2","ward":"","street":"Lê Lợi","note":"chung cư Avenue"}', 5);
	
	INSERT INTO public."TreatmentPlace"(
	id, name, address, capacity)
	VALUES (3, 'Bệnh viện dã chiến số 3', '{"city":"TP.HCM","district":"Quận 2","ward":"Tịnh Biên","street":"","note":"chung cư Diamond Riverside"}', 10);
	
	INSERT INTO public."TreatmentPlace"(
	id, name, address, capacity)
	VALUES (4, 'Bệnh viện dã chiến số 4', '{"city":"TP.HCM","district":"Quận 2","ward":"","street":"","note":""}', 50);
	
	INSERT INTO public."TreatmentPlace"(
	id, name, address, capacity)
	VALUES (5, 'Bệnh viện dã chiến số 5', '{"city":"TP.HCM","district":"Quận 9","ward":"10","street":"Kiều Lương","note":""}', 80);
    
